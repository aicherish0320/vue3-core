{"version":3,"file":"vue.js","sources":["../src/reactivity/computed.ts","../src/shared/index.ts","../src/reactivity/effect.ts","../src/reactivity/baseHandlers.ts","../src/reactivity/reactive.ts","../src/reactivity/ref.ts"],"sourcesContent":["export function computed() {}\r\n","export const isObject = (val) => typeof val === 'object' && val !== null\r\nexport const isSymbol = (val) => typeof val === 'symbol'\r\nexport const isArray = (val) => Array.isArray(val)\r\nexport const isInteger = (key) => parseInt(key, 10) + '' === key\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty\r\nexport const hasOwn = (val, key) => hasOwnProperty.call(val, key)\r\nexport const hasChanged = (value, oldValue) => value !== oldValue\r\n","import { isArray, isInteger } from './../shared/index'\r\nexport function effect(fn, options: any = {}) {\r\n  const effect = createReactiveEffect(fn, options)\r\n\r\n  if (!options.lazy) {\r\n    effect()\r\n  }\r\n\r\n  return effect\r\n}\r\n\r\nlet activeEffect\r\nlet uid = 0\r\nconst effectStack = []\r\nfunction createReactiveEffect(fn, options) {\r\n  const effect = function () {\r\n    if (!effectStack.includes(effect)) {\r\n      try {\r\n        activeEffect = effect\r\n        effectStack.push(activeEffect)\r\n        return fn()\r\n      } catch (error) {\r\n      } finally {\r\n        effectStack.pop()\r\n        activeEffect = effectStack[effectStack.length - 1]\r\n      }\r\n    }\r\n  }\r\n\r\n  effect.id = uid++\r\n  effect.deps = []\r\n  effect.options = options\r\n\r\n  return effect\r\n}\r\n\r\n// { object: { key: [effect1, effect2] } }\r\nconst targetMap = new WeakMap()\r\nexport function track(target, key) {\r\n  if (!activeEffect) return\r\n\r\n  let depsMap = targetMap.get(target)\r\n  if (!depsMap) {\r\n    targetMap.set(target, (depsMap = new Map()))\r\n  }\r\n  let dep = depsMap.get(key)\r\n  if (!dep) {\r\n    depsMap.set(key, (dep = new Set()))\r\n  }\r\n  if (!dep.has(activeEffect)) {\r\n    dep.add(activeEffect)\r\n    activeEffect.deps.push(key)\r\n  }\r\n}\r\n\r\nexport function trigger(target, type, key, value?, oldValue?) {\r\n  debugger\r\n  const depsMap = targetMap.get(target)\r\n  if (!depsMap) return\r\n\r\n  const run = (effects) => {\r\n    if (effects) {\r\n      effects.forEach((effect) => effect())\r\n    }\r\n  }\r\n\r\n  if (key === 'length' && isArray(target)) {\r\n    depsMap.forEach((dep, key) => {\r\n      if (key === 'length' || key >= value) {\r\n        run(dep)\r\n      }\r\n    })\r\n  } else {\r\n    if (key) {\r\n      run(depsMap.get(key))\r\n    }\r\n\r\n    switch (type) {\r\n      case 'add':\r\n        if (isArray(target)) {\r\n          if (isInteger(key)) {\r\n            run(depsMap.get('length'))\r\n          }\r\n        }\r\n        break\r\n\r\n      default:\r\n        break\r\n    }\r\n  }\r\n}\r\n","import {\r\n  isObject,\r\n  isArray,\r\n  isInteger,\r\n  hasOwn,\r\n  hasChanged\r\n} from './../shared/index'\r\nimport { track, trigger } from './effect'\r\nimport { reactive } from './reactive'\r\nfunction createGetter() {\r\n  return function get(target, key, receiver) {\r\n    console.log('key >>> ', key)\r\n\r\n    const ret = Reflect.get(target, key, receiver)\r\n    track(target, key)\r\n\r\n    if (isObject(ret)) {\r\n      return reactive(ret)\r\n    }\r\n\r\n    return ret\r\n  }\r\n}\r\nfunction createSetter() {\r\n  return function set(target, key, value, receiver) {\r\n    const oldValue = target[key]\r\n    // 数组新增、对象新增\r\n    const hadKey =\r\n      isArray(target) && isInteger(key)\r\n        ? Number(key) < target.length\r\n        : hasOwn(target, key)\r\n\r\n    const ret = Reflect.set(target, key, value, receiver)\r\n\r\n    if (!hadKey) {\r\n      trigger(target, 'add', key, value)\r\n    } else if (hasChanged(value, oldValue)) {\r\n      trigger(target, 'set', key, value, oldValue)\r\n    }\r\n\r\n    return ret\r\n  }\r\n}\r\n\r\nconst get = createGetter()\r\nconst set = createSetter()\r\n\r\nexport const mutableHandlers = {\r\n  get,\r\n  set\r\n}\r\n","import { mutableHandlers } from './baseHandlers'\r\nimport { isObject } from './../shared/index'\r\n\r\nexport function reactive(target: object) {\r\n  // 核心的操作就是当读取数据时进行依赖收集，修改数据的时候让effect重新执行\r\n  return createReactiveObject(target, mutableHandlers)\r\n}\r\n\r\nconst proxyMap = new WeakMap()\r\nfunction createReactiveObject(target: object, baseHandlers) {\r\n  if (!isObject(target)) return target\r\n\r\n  const existingProxy = proxyMap.get(target)\r\n  if (existingProxy) {\r\n    return existingProxy\r\n  }\r\n\r\n  const proxy = new Proxy(target, baseHandlers)\r\n  proxyMap.set(target, proxy)\r\n\r\n  return proxy\r\n}\r\n","export function ref() {}\r\n"],"names":[],"mappings":"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"}